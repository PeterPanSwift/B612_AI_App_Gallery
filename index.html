<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>小王子 AI App 星球</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600&family=Space+Grotesk:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="starfield" aria-hidden="true"></div>
    <div class="header-inner">
      <div class="logo">B612 Gallery</div>
      <nav class="nav-links" aria-label="主要導覽">
        <a href="#apps">App 星球</a>
        <a href="#samples">程式範例</a>
        <a href="#about">故事</a>
      </nav>
    </div>
    <div class="hero">
      <div class="hero-text">
        <p class="eyebrow">在 B612 星球上捕捉靈感</p>
        <h1>小王子的 AI App 收藏</h1>
        <p>
          每一顆星星都是一個想像力的宇宙。我把 AI 打造成小工具，
          也用程式紀錄旅途中綻放的靈感。
        </p>
        <a class="cta" href="#apps">探索星球</a>
      </div>
      <div class="hero-planet" aria-hidden="true">
        <div class="planet"></div>
        <div class="prince"></div>
        <div class="rose"></div>
      </div>
    </div>
  </header>

  <main>
    <section id="apps" class="app-grid" aria-labelledby="apps-title">
      <div class="section-heading">
        <h2 id="apps-title">App 星球清單</h2>
        <p>選一顆星，拜訪不同世界裡的 AI 靈感。</p>
      </div>
      <div class="search" role="search">
        <label class="search-label" for="app-search">搜尋 App</label>
        <input
          type="search"
          id="app-search"
          name="app-search"
          placeholder="輸入關鍵字、技術或敘述"
          autocomplete="off"
          aria-describedby="search-hint"
          disabled
        />
        <p id="search-hint" class="search-hint">即時篩選下方 App</p>
      </div>

      <div class="cards" data-empty-message="找不到符合的 App，小王子仍在尋找中。"></div>
    </section>

    <section id="samples" class="code-grid" aria-labelledby="samples-title">
      <div class="section-heading">
        <h2 id="samples-title">程式範例星雲</h2>
        <p>收藏把靈感化作程式的筆記，從圖形到互動都在此發光。</p>
      </div>
      <div class="search" role="search">
        <label class="search-label" for="sample-search">搜尋程式範例</label>
        <input
          type="search"
          id="sample-search"
          name="sample-search"
          placeholder="輸入關鍵字、技術或描述"
          autocomplete="off"
          aria-describedby="sample-search-hint"
          disabled
        />
        <p id="sample-search-hint" class="search-hint">用關鍵字或技術找到程式靈感</p>
      </div>

      <div
        class="cards sample-cards"
        data-empty-message="找不到符合的程式範例，小王子正在編排程式星塵。"
      ></div>
    </section>

    <section id="about" class="about" aria-labelledby="about-title">
      <div class="section-heading">
        <h2 id="about-title">旅人的手記</h2>
      </div>
      <p>
        小王子說：真正重要的事物是肉眼看不見的。這些 App 是我和 AI 一起
        探索心中星空的紀錄。希望你也能在這些星球裡，找到屬於自己的靈感。
      </p>
    </section>
  </main>

  <footer class="site-footer">
    <span>© B612 AI App Gallery · 保留一點童真。</span>
  </footer>

  <script>
    const appCardsContainer = document.querySelector('#apps .cards');
    const sampleCardsContainer = document.querySelector('#samples .sample-cards');

    const appConfig = {
      input: document.querySelector('#app-search'),
      container: appCardsContainer,
      url: 'apps.json',
      defaultEmptyMessage:
        appCardsContainer?.dataset.emptyMessage || '找不到符合的 App，小王子仍在尋找中。',
      loadingMessage: '載入 App 清單中...',
      errorMessage: '無法載入 App 清單，請稍後再試。',
      build: createAppCard,
      extras: (item) => (item.github ? ['github'] : []),
      records: [],
    };

    const sampleConfig = {
      input: document.querySelector('#sample-search'),
      container: sampleCardsContainer,
      url: 'samples.json',
      defaultEmptyMessage:
        sampleCardsContainer?.dataset.emptyMessage || '找不到程式範例，小王子正在編排程式星塵。',
      loadingMessage: '載入程式範例中...',
      errorMessage: '無法載入程式範例，請稍後再試。',
      build: createSampleCard,
      extras: () => ['code', 'sample', '程式範例'],
      records: [],
    };

    const datasets = [appConfig, sampleConfig];

    datasets.forEach((config) => {
      if (!config.container) return;
      installSearch(config);
      loadDataset(config);
    });

    function normalise(text) {
      return (text || '').toLowerCase().replace(/\s+/g, '');
    }

    function showEmptyMessage(container, message, visible) {
      let emptyState = container.querySelector('.empty-state');
      if (!emptyState) {
        emptyState = document.createElement('div');
        emptyState.className = 'empty-state';
        container.appendChild(emptyState);
      }
      emptyState.textContent = message;
      emptyState.style.display = visible ? 'block' : 'none';
    }

    function renderList(config, records) {
      config.container.innerHTML = '';
      const fragment = document.createDocumentFragment();
      records.forEach((item) => {
        fragment.appendChild(config.build(item));
      });
      config.container.appendChild(fragment);
      showEmptyMessage(config.container, config.defaultEmptyMessage, records.length === 0);
    }

    function showStatus(config, message) {
      config.container.innerHTML = '';
      showEmptyMessage(config.container, message, true);
    }

    function prepareRecords(data, extrasFn = () => []) {
      return data.map((item) => {
        const extras = extrasFn(item) || [];
        return {
          ...item,
          searchIndex: normalise([item.title, ...(item.tags || []), ...extras].join(' ')),
        };
      });
    }

    function filterRecords(config, keyword) {
      const query = normalise(keyword);
      if (query === '') return config.records;
      return config.records.filter((item) => item.searchIndex.includes(query));
    }

    function installSearch(config) {
      if (!config.input) return;
      config.input.addEventListener('input', (event) => {
        if (!config.records) return;
        const filtered = filterRecords(config, event.target.value);
        renderList(config, filtered);
      });
    }

    async function loadDataset(config) {
      if (!config.container) return;
      if (config.input) {
        config.input.disabled = true;
      }
      showStatus(config, config.loadingMessage);
      try {
        const response = await fetch(config.url);
        if (!response.ok) throw new Error(`Failed to load ${config.url}`);

        const data = await response.json();
        config.records = prepareRecords(data, config.extras);
        renderList(config, config.records);
        if (config.input) {
          config.input.disabled = false;
        }
      } catch (error) {
        console.error(`Unable to load data from ${config.url}`, error);
        showStatus(config, config.errorMessage);
      }
    }

    function createAppCard(app) {
      const article = document.createElement('article');
      article.className = 'card';
      article.dataset.title = app.title;
      article.dataset.tags = (app.tags || []).join(' ');

      const title = document.createElement('h3');
      title.textContent = app.title;

      const primaryLink = document.createElement('a');
      primaryLink.className = 'card-link';
      primaryLink.href = app.url;
      primaryLink.target = '_blank';
      primaryLink.rel = 'noopener';
      primaryLink.textContent = '前往 App';

      const actions = document.createElement('div');
      actions.className = 'card-actions';
      actions.appendChild(primaryLink);

      if (app.github) {
        const githubLink = document.createElement('a');
        githubLink.className = 'card-link';
        githubLink.href = app.github;
        githubLink.target = '_blank';
        githubLink.rel = 'noopener';
        githubLink.textContent = '前往 GitHub';
        actions.appendChild(githubLink);
      }

      article.append(title, actions);
      return article;
    }

    function createSampleCard(sample) {
      const article = document.createElement('article');
      article.className = 'card sample-card';
      article.dataset.title = sample.title;
      article.dataset.tags = (sample.tags || []).join(' ');

      if (sample.previewImage) {
        const figure = document.createElement('div');
        figure.className = 'sample-visual';

        const img = document.createElement('img');
        img.className = 'sample-thumb';
        img.src = sample.previewImage;
        img.alt = `${sample.title} 預覽圖`;
        img.loading = 'lazy';
        img.decoding = 'async';

        figure.appendChild(img);
        article.appendChild(figure);
      }

      const title = document.createElement('h3');
      title.textContent = sample.title;

      const actions = document.createElement('div');
      actions.className = 'card-actions';

      const codeLink = document.createElement('a');
      codeLink.className = 'card-link';
      codeLink.href = sample.url;
      codeLink.target = '_blank';
      codeLink.rel = 'noopener';
      codeLink.textContent = '檢視程式碼';

      actions.appendChild(codeLink);
      article.append(title, actions);

      return article;
    }
  </script>
</body>
</html>
