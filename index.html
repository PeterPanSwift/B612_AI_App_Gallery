<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>小王子 AI App 星球</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600&family=Space+Grotesk:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="starfield" aria-hidden="true"></div>
    <div class="header-inner">
      <div class="logo">B612 Gallery</div>
      <nav class="nav-links" aria-label="主要導覽">
        <a href="#apps">App 星球</a>
        <a href="#about">故事</a>
      </nav>
    </div>
    <div class="hero">
      <div class="hero-text">
        <p class="eyebrow">在 B612 星球上捕捉靈感</p>
        <h1>小王子的 AI App 收藏</h1>
        <p>
          每一顆星星都是一個想像力的宇宙。我用 AI 打造了一系列小工具，
          想和你分享這些旅途中遇見的星球。
        </p>
        <a class="cta" href="#apps">探索星球</a>
      </div>
      <div class="hero-planet" aria-hidden="true">
        <div class="planet"></div>
        <div class="prince"></div>
        <div class="rose"></div>
      </div>
    </div>
  </header>

  <main>
    <section id="apps" class="app-grid" aria-labelledby="apps-title">
      <div class="section-heading">
        <h2 id="apps-title">App 星球清單</h2>
        <p>選一顆星，拜訪不同世界裡的 AI 靈感。</p>
      </div>
      <div class="search" role="search">
        <label class="search-label" for="app-search">搜尋 App</label>
        <input
          type="search"
          id="app-search"
          name="app-search"
          placeholder="輸入關鍵字、技術或敘述"
          autocomplete="off"
          aria-describedby="search-hint"
          disabled
        />
        <p id="search-hint" class="search-hint">即時篩選下方 App</p>
      </div>

      <div class="cards" data-empty-message="找不到符合的 App，小王子仍在尋找中。"></div>
    </section>

    <section id="about" class="about" aria-labelledby="about-title">
      <div class="section-heading">
        <h2 id="about-title">旅人的手記</h2>
      </div>
      <p>
        小王子說：真正重要的事物是肉眼看不見的。這些 App 是我和 AI 一起
        探索心中星空的紀錄。希望你也能在這些星球裡，找到屬於自己的靈感。
      </p>
    </section>
  </main>

  <footer class="site-footer">
    <span>© B612 AI App Gallery · 保留一點童真。</span>
  </footer>

  <script>
    const searchInput = document.querySelector('#app-search');
    const cardsContainer = document.querySelector('.cards');
    const defaultEmptyMessage = cardsContainer.dataset.emptyMessage;
    const loadingMessage = '載入 App 清單中...';
    let apps = [];

    function normalise(text) {
      return text.toLowerCase().replace(/\s+/g, '');
    }

    function updateEmptyState(count) {
      let emptyState = cardsContainer.querySelector('.empty-state');
      if (!emptyState) {
        emptyState = document.createElement('div');
        emptyState.className = 'empty-state';
        cardsContainer.appendChild(emptyState);
      }
      emptyState.textContent = cardsContainer.dataset.emptyMessage;
      emptyState.style.display = count === 0 ? 'block' : 'none';
    }

    function createCard(app) {
      const article = document.createElement('article');
      article.className = 'card';
      article.dataset.title = app.title;
      article.dataset.tags = (app.tags || []).join(' ');

      const title = document.createElement('h3');
      title.textContent = app.title;

      const link = document.createElement('a');
      link.className = 'card-link';
      link.href = app.url;
      link.target = '_blank';
      link.rel = 'noopener';
      link.textContent = '前往 App';

      article.append(title, link);
      return article;
    }

    function renderCards(list) {
      cardsContainer.innerHTML = '';
      const fragment = document.createDocumentFragment();
      list.forEach((app) => {
        fragment.appendChild(createCard(app));
      });
      cardsContainer.appendChild(fragment);
      updateEmptyState(list.length);
    }

    function filterApps(keyword) {
      const query = normalise(keyword);
      if (query === '') {
        renderCards(apps);
        return;
      }

      const filtered = apps.filter((app) => app.searchIndex.includes(query));
      renderCards(filtered);
    }

    function prepareApps(data) {
      return data.map((app) => ({
        ...app,
        searchIndex: normalise([app.title, ...(app.tags || [])].join(' ')),
      }));
    }

    async function loadApps() {
      try {
        cardsContainer.dataset.emptyMessage = loadingMessage;
        updateEmptyState(0);

        const response = await fetch('apps.json');
        if (!response.ok) throw new Error('Failed to load apps.json');

        const data = await response.json();
        apps = prepareApps(data);
        cardsContainer.dataset.emptyMessage = defaultEmptyMessage;
        renderCards(apps);
        searchInput.disabled = false;
      } catch (error) {
        console.error('Unable to load apps', error);
        cardsContainer.dataset.emptyMessage = '無法載入 App 清單，請稍後再試。';
        cardsContainer.innerHTML = '';
        updateEmptyState(0);
      }
    }

    if (searchInput) {
      searchInput.addEventListener('input', (event) => {
        filterApps(event.target.value);
      });
    }

    loadApps();
  </script>
</body>
</html>
